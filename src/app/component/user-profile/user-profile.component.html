<div class="user-profile-div">
  <div class="row d-flex align-items-center justify-content-center my-auto mx-auto h-100">
    <mat-card class="shadow pb-2" [ngStyle]="{'width': isMobileView ? '80%' : '50%'}" *ngIf="!!userData else loader">
      <mat-card-content>
        <div class="d-flex flex-row align-items-center justify-content-center">
          <div class="initial-letter">
            {{ avatarName }}
          </div>
        </div>
        <div class="d-flex flex-row w-100 align-items-center justify-content-center">
          <div class="w-100" *ngIf="profilePageForm || changePasswordForm">
            <ng-container *ngIf="!showPasswordChange" [formGroup]="profilePageForm">
              <table class="table mt-3 w-100">
                <tr class="font-weight-bold">
                  <th>Full Name</th>
                  <td *ngIf="!editMode" class="h6 small">{{ userData?.name | titlecase }}</td>
                  <td *ngIf="editMode">
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput formControlName="name" required>
                      <mat-error *ngIf="getControl(profilePageForm,'name')?.hasError('required')">
                        Name is required
                      </mat-error>
                      <mat-error *ngIf="getControl(profilePageForm,'name')?.hasError('pattern')">
                        Enter valid Name.
                      </mat-error>
                    </mat-form-field>
                  </td>
                </tr>
                <tr>
                  <th>Email</th>
                  <td *ngIf="!editMode" class="h6 small">{{ userData?.email | lowercase }}</td>
                  <td *ngIf="editMode">
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput formControlName="email" required readonly>
                    </mat-form-field>
                  </td>
                </tr>
                <tr>
                  <th>Phone</th>
                  <td *ngIf="!editMode" class="h6 small">{{ userData?.contact }}</td>
                  <td *ngIf="editMode">
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput formControlName="contact" type="text" maxlength="10" required>
                      <mat-error *ngIf="getControl(profilePageForm, 'contact')?.hasError('required')">
                        Contact is required.
                      </mat-error>
                      <mat-error *ngIf="getControl(profilePageForm, 'contact')?.hasError('pattern')">
                        Enter valid Contact.
                      </mat-error>
                    </mat-form-field>
                  </td>
                </tr>
                <tr>
                  <th>Gender</th>
                  <td *ngIf="!editMode" class="h6 small">{{ userData?.gender | titlecase }}</td>
                  <td *ngIf="editMode">
                    <mat-radio-group formControlName="gender" required color="primary">
                      <mat-radio-button value="male">Male</mat-radio-button>
                      <mat-radio-button value="female">Female</mat-radio-button>
                    </mat-radio-group>
                  </td>
                </tr>
                <tr>
                  <th>Date of Birth</th>
                  <td *ngIf="!editMode" class="h6 small">{{ userData?.birth_date | date: 'dd-MM-YYYY' }}</td>
                  <td *ngIf="editMode">
                    <mat-form-field appearance="outline" class="w-100 mb-2">
                      <input matInput formControlName="birth_date" [matDatepicker]="picker" placeholder="DD/MM/YYYY" required>
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker ></mat-datepicker>
                      <mat-error *ngIf="getControl(profilePageForm, 'birth_date')?.hasError('required')">
                        Date Of Birth is required.
                      </mat-error>
                    </mat-form-field>
                  </td>
                </tr>
              </table>
              <div class="d-flex w-100 flex-row align-items-center justify-content-between" *ngIf="!editMode">
                <button class="common-btn btn-update" (click)="editUserdetails()"> Update Profile </button>
                <button class="common-btn btn-change" (click)="onHideShowPasswordForm()"> Change Password </button>
              </div>
              <div class="d-flex w-100 flex-row align-items-center justify-content-end" *ngIf="editMode">
                <button class="common-btn btn-cancel m-2" (click)="cancelUpdate()"> Cancel </button>
                <button class="common-btn btn-save m-2" (click)="updateUserDetails()"> Update </button>
              </div>
            </ng-container>
            <ng-container *ngIf="showPasswordChange" [formGroup]="changePasswordForm">
              <table class="table mt-3 w-100">
                <tr class="font-weight-bold">
                  <th>Current Password</th>
                  <td>
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" required>
                      <mat-icon matSuffix (click)="hidePassword = !hidePassword">
                        {{hidePassword ? 'visibility' : 'visibility_off'}}
                      </mat-icon>
                      <mat-error *ngIf="getControl(changePasswordForm, 'password')?.hasError('required')">
                        Password is required.
                      </mat-error>
                    </mat-form-field>
                  </td>
                </tr>
                <tr>
                  <th>New Password</th>
                  <td>
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="newPassword" minlength="8" required>
                      <mat-icon matSuffix (click)="hideNewPassword = !hideNewPassword">
                        {{hideNewPassword ? 'visibility' : 'visibility_off'}}
                      </mat-icon>
                      <mat-error *ngIf="getControl(changePasswordForm, 'newPassword')?.hasError('required')">
                        Password is required.
                      </mat-error>
                      <mat-error *ngIf="getControl(changePasswordForm, 'newPassword')?.hasError('pattern')">
                        Make a strong password.
                      </mat-error>
                    </mat-form-field>
                  </td>
                </tr>
                <tr>
                  <th>Confirm Password</th>
                  <td>
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput [type]="hideconfirmPassword ? 'password' : 'text'" formControlName="confirmPassword" minlength="8" required>
                      <mat-icon matSuffix (click)="hideconfirmPassword = !hideconfirmPassword">
                        {{hideconfirmPassword ? 'visibility' : 'visibility_off'}}
                      </mat-icon>
                      <mat-error *ngIf="getControl(changePasswordForm, 'confirmPassword')?.hasError('required')">
                        Password is required.
                      </mat-error>
                      <mat-error *ngIf="!getControl(changePasswordForm, 'confirmPassword')?.hasError('required') && getControl(changePasswordForm, 'confirmPassword')?.hasError('passwordMismatch')">
                        Enter password same as new password.
                      </mat-error>
                    </mat-form-field>
                  </td>
                </tr>
              </table>
              <div class="d-flex w-100 flex-row justify-content-end">
                <button class="common-btn btn-cancel m-2" (click)="cancelUpdate()"> Cancel </button>
                <button class="common-btn btn-save m-2" (click)="updatePassword()"> Update </button>
              </div>
            </ng-container>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
    <ng-template #loader>
      <mat-spinner [diameter]="50"></mat-spinner>
    </ng-template>
  </div>
</div>
